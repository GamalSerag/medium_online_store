{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans "All Products" %} - {% trans "Al-Serag Store" %}{% endblock %}

{% block content %}
<!-- Header -->
<section class="bg-gradient-to-br from-indigo-600 via-purple-600 to-pink-500 text-white py-16">
    <div class="max-w-7xl mx-auto px-4 sm:px-6">
        <nav class="text-sm mb-4 text-white/70">
            <a href="{% url 'home' %}" class="hover:text-white">{% trans "Home" %}</a>
            <span class="mx-2">/</span>
            <span class="text-white">{% trans "All Products" %}</span>
        </nav>
        <h1 class="text-4xl md:text-5xl font-bold">{% trans "All Products" %}</h1>
        <p class="mt-2 text-white/80">
            {{ products.paginator.count }} {% trans "products found" %}
        </p>
    </div>
</section>

<!-- Main Content -->
<section class="py-12 bg-gray-50">
    <div class="max-w-7xl mx-auto px-4 sm:px-6">
        <div class="flex flex-col lg:flex-row gap-8">

            <!-- Sidebar Filters -->
            <aside class="lg:w-72 flex-shrink-0">
                <div class="bg-white rounded-2xl shadow-md p-6 sticky top-24">
                    <h3 class="text-lg font-bold text-gray-900 mb-6">{% trans "Filters" %}</h3>

                    <form method="get" action="">
                        <!-- Search -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">{% trans "Search" %}</label>
                            <div class="relative">
                                <input type="text" name="q" value="{{ search_query }}"
                                    placeholder="{% trans 'Search products...' %}"
                                    class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all">
                                <svg class="absolute right-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" fill="none"
                                    stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                                </svg>
                            </div>
                        </div>

                        <!-- Category Filter -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">{% trans "Category" %}</label>
                            <select name="category"
                                class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all">
                                <option value="">{% trans "All Categories" %}</option>
                                {% for cat in all_categories %}
                                <option value="{{ cat.slug }}" {% if selected_category == cat.slug %}selected{% endif %}>{{ cat.name }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <!-- Price Range -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">{% trans "Price Range" %}</label>
                            <div class="flex gap-3">
                                <input type="number" name="min_price" value="{{ min_price }}"
                                    placeholder="{% trans 'Min' %}" min="0" step="0.01"
                                    class="w-1/2 px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                                <input type="number" name="max_price" value="{{ max_price }}"
                                    placeholder="{% trans 'Max' %}" min="0" step="0.01"
                                    class="w-1/2 px-3 py-2 border border-gray-200 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
                            </div>
                        </div>

                        <!-- Sort By -->
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">{% trans "Sort By" %}</label>
                            <select name="sort"
                                class="w-full px-4 py-3 border border-gray-200 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all">
                                <option value="newest" {% if sort_by == 'newest' %}selected{% endif %}>{% trans "Newest First" %}</option>
                                <option value="price_low" {% if sort_by == 'price_low' %}selected{% endif %}>{% trans "Price: Low to High" %}</option>
                                <option value="price_high" {% if sort_by == 'price_high' %}selected{% endif %}>{% trans "Price: High to Low" %}</option>
                                <option value="name" {% if sort_by == 'name' %}selected{% endif %}>{% trans "Name: A to Z" %}</option>
                            </select>
                        </div>

                        <!-- Filter Button -->
                        <button type="submit"
                            class="w-full bg-indigo-600 text-white py-3 rounded-xl font-semibold hover:bg-indigo-700 transition-colors">
                            {% trans "Apply Filters" %}
                        </button>

                        {% if search_query or min_price or max_price or selected_category or sort_by != 'newest' %}
                        <a href="{% url 'all_products' %}"
                            class="block w-full text-center mt-3 text-indigo-600 hover:text-indigo-800 font-medium">
                            {% trans "Clear Filters" %}
                        </a>
                        {% endif %}
                    </form>
                </div>
            </aside>

            <!-- Products Grid -->
            <div class="flex-1">
                {% if products %}
                <div class="grid grid-cols-2 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                    {% for product in products %}
                    {% include 'pages/partials/_product_card.html' with product=product %}
                    {% endfor %}
                </div>

                <!-- Pagination -->
                {% if is_paginated %}
                <nav class="mt-12 flex justify-center">
                    <ul class="flex items-center gap-2">
                        {% if page_obj.has_previous %}
                        <li>
                            <a href="?page={{ page_obj.previous_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}"
                                class="px-4 py-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                                {% trans "Previous" %}
                            </a>
                        </li>
                        {% endif %}

                        {% for num in page_obj.paginator.page_range %}
                        {% if page_obj.number == num %}
                        <li>
                            <span class="px-4 py-2 bg-indigo-600 text-white rounded-lg font-medium">{{ num }}</span>
                        </li>
                        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
                        <li>
                            <a href="?page={{ num }}{% if search_query %}&q={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}"
                                class="px-4 py-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                                {{ num }}
                            </a>
                        </li>
                        {% endif %}
                        {% endfor %}

                        {% if page_obj.has_next %}
                        <li>
                            <a href="?page={{ page_obj.next_page_number }}{% if search_query %}&q={{ search_query }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}{% if min_price %}&min_price={{ min_price }}{% endif %}{% if max_price %}&max_price={{ max_price }}{% endif %}{% if sort_by %}&sort={{ sort_by }}{% endif %}"
                                class="px-4 py-2 bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors">
                                {% trans "Next" %}
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </nav>
                {% endif %}

                {% else %}
                <!-- No Products Found -->
                <div class="text-center py-16 bg-white rounded-2xl shadow-sm">
                    <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor"
                        viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
                            d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <h3 class="text-xl font-semibold text-gray-700 mb-2">{% trans "No products found" %}</h3>
                    <p class="text-gray-500 mb-6">{% trans "Try adjusting your search or filter criteria" %}</p>
                    <a href="{% url 'all_products' %}"
                        class="inline-flex items-center gap-2 px-6 py-3 bg-indigo-600 text-white rounded-xl font-semibold hover:bg-indigo-700 transition-colors">
                        {% trans "Clear Filters" %}
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>
{% endblock %}
